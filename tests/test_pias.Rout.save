
R version 4.1.0 (2021-05-18) -- "Camp Pontanezen"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(piar)
> 
> # corner cases
> unclass(aggregation_structure(list()))
$child
list()

$parent
list()

$levels
character(0)

$weights
named numeric(0)

$height
[1] 0

> 
> weights(aggregation_structure(list()))
named list()
> 
> weights(aggregation_structure(list()), ea_only = TRUE)
named numeric(0)
> 
> unclass(aggregation_structure(list(1:5)))
$child
list()

$parent
list()

$levels
[1] "1" "2" "3" "4" "5"

$weights
1 2 3 4 5 
1 1 1 1 1 

$height
[1] 1

> 
> weights(aggregation_structure(list(1:5)))
[[1]]
1 2 3 4 5 
1 1 1 1 1 

> 
> weights(aggregation_structure(list(1:5)), ea_only = TRUE)
1 2 3 4 5 
1 1 1 1 1 
> 
> # should give a warning about improper parent nodes
> aggregation_structure(list(1:2, c(3, 3), c(4, 5)))
Price index aggregation structure with 2 elementary aggregates and 2 upper-level indexes 
[[1]]
[1] "1" "2"

[[2]]
[1] "3"

[[3]]
[1] "4" "5"

Warning message:
In aggregation_structure(list(1:2, c(3, 3), c(4, 5))) :
  some nodes in the price index aggregation structure have multiple parent nodes; the aggregation structure does not represent a nested hierachy
> 
> # a real-ish example
> x1 <- c("1", "1", "1", "2")
> x2 <- c("11", "11", "12", "21")
> x3 <- c("111", "112", "121", "211")
> 
> (agg1 <- aggregation_structure(list(x1, x2, x3)))
Price index aggregation structure with 4 elementary aggregates and 2 upper-level indexes 
[[1]]
[1] "1" "2"

[[2]]
[1] "11" "12" "21"

[[3]]
[1] "111" "112" "121" "211"

> 
> unclass(agg1)
$child
$child[[1]]
$child[[1]]$`11`
[1] 1 2

$child[[1]]$`12`
[1] 3

$child[[1]]$`21`
[1] 4


$child[[2]]
$child[[2]]$`1`
[1] 1 2

$child[[2]]$`2`
[1] 3



$parent
$parent[[1]]
111 112 121 211 
  1   1   2   3 

$parent[[2]]
11 12 21 
 1  1  2 


$levels
[1] "1"   "2"   "11"  "12"  "21"  "111" "112" "121" "211"

$weights
111 112 121 211 
  1   1   1   1 

$height
[1] 3

> 
> all.equal(agg1, aggregation_structure(expand_classification(x3)))
[1] TRUE
> 
> # calculate weights
> weights(agg1)
[[1]]
111 112 121 211 
  1   1   1   1 

[[2]]
11 12 21 
 2  1  1 

[[3]]
1 2 
3 1 

> 
> weights(agg1, ea_only = TRUE)
111 112 121 211 
  1   1   1   1 
> 
> weights(aggregation_structure(list(x1, x2, x3), 1:4))
[[1]]
111 112 121 211 
  1   2   3   4 

[[2]]
11 12 21 
 3  3  4 

[[3]]
1 2 
6 4 

> 
> weights(aggregation_structure(list(x1, x2, x3), c(NA, 2:4)))
[[1]]
111 112 121 211 
 NA   2   3   4 

[[2]]
11 12 21 
NA  3  4 

[[3]]
 1  2 
NA  4 

> 
> weights(aggregation_structure(list(x1, x2, x3), c(NA, 2:4)), na.rm = TRUE)
[[1]]
111 112 121 211 
 NA   2   3   4 

[[2]]
11 12 21 
 2  3  4 

[[3]]
1 2 
5 4 

> 
> # change delimiter
> (agg2 <- aggregation_structure(expand_classification(c("1.1.1", "1.1.2", "1.2.1"), c(2, 2, 1))))
Price index aggregation structure with 3 elementary aggregates and 2 upper-level indexes 
[[1]]
[1] "1."

[[2]]
[1] "1.1." "1.2."

[[3]]
[1] "1.1.1" "1.1.2" "1.2.1"

> 
> unclass(agg2)
$child
$child[[1]]
$child[[1]]$`1.1.`
[1] 1 2

$child[[1]]$`1.2.`
[1] 3


$child[[2]]
$child[[2]]$`1.`
[1] 1 2



$parent
$parent[[1]]
1.1.1 1.1.2 1.2.1 
    1     1     2 

$parent[[2]]
1.1. 1.2. 
   1    1 


$levels
[1] "1."    "1.1."  "1.2."  "1.1.1" "1.1.2" "1.2.1"

$weights
1.1.1 1.1.2 1.2.1 
    1     1     1 

$height
[1] 3

> 
> # change start
> (agg3 <- aggregation_structure(expand_classification(c("1.1.1", "1.1.2", "1.2.1"), c(4, 1))))
Price index aggregation structure with 3 elementary aggregates and 1 upper-level index 
[[1]]
[1] "1.1." "1.2."

[[2]]
[1] "1.1.1" "1.1.2" "1.2.1"

> 
> unclass(agg3)
$child
$child[[1]]
$child[[1]]$`1.1.`
[1] 1 2

$child[[1]]$`1.2.`
[1] 3



$parent
$parent[[1]]
1.1.1 1.1.2 1.2.1 
    1     1     2 


$levels
[1] "1.1."  "1.2."  "1.1.1" "1.1.2" "1.2.1"

$weights
1.1.1 1.1.2 1.2.1 
    1     1     1 

$height
[1] 2

> 
> proc.time()
   user  system elapsed 
  0.097   0.020   0.111 
