<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Compute period-over-period or fixed-base (direct) elemental price indexes (with optional quote contributions), or coerce pre-computed index values into an index object. There are methods to aggregate these indexes with a price index aggregation structure or average them over subperiods, combine indexes together, extract useful information, and coerce into a tabular form."><title>Price indexes — price_indexes • piar</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Price indexes — price_indexes"><meta property="og:description" content="Compute period-over-period or fixed-base (direct) elemental price indexes (with optional quote contributions), or coerce pre-computed index values into an index object. There are methods to aggregate these indexes with a price index aggregation structure or average them over subperiods, combine indexes together, extract useful information, and coerce into a tabular form."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">piar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/piar.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/marberts/piar/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Price indexes</h1>
      
      <div class="d-none name"><code>price-indexes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute period-over-period or fixed-base (direct) elemental price indexes (with optional quote contributions), or coerce pre-computed index values into an index object. There are methods to aggregate these indexes with a price index aggregation structure or average them over subperiods, combine indexes together, extract useful information, and coerce into a tabular form.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre><code># Elemental indexes
elemental_index(rel, ...)

# S3 method for default
elemental_index(rel, ...)

# S3 method for numeric
elemental_index(rel, period = gl(1, length(rel)), 
                ea = gl(1, length(rel)), w, contrib = FALSE, 
                chainable = TRUE, na.rm = FALSE, r = 0, ...)
                            
# Aggregate
# S3 method for ind
aggregate(x, pias, na.rm = FALSE, r = 1, ...)

# S3 method for agg_ind
vcov(object, repweights, mse = TRUE, ...)

# S3 method for ind
mean(x, w, window = 3, na.rm = FALSE, r = 1, ...)

# Combine
# S3 method for ind
merge(x, y, ...)

# S3 method for ind
stack(x, y, ...)

# S3 method for ind
unstack(x, ...)

# Extract
# S3 method for ind
[(x, i, j)

# S3 method for ind
[(x, i, j) &lt;- value

# S3 method for ind
levels(x)

# S3 method for ind
time(x, ...)

# S3 method for ind
start(x, ...)

# S3 method for ind
end(x, ...)

# S3 method for ind
head(x, n = 6, ...)

# S3 method for ind
tail(x, n = 6, ...)

# Coerce
# S3 method for ind
as.matrix(x, ...)

# S3 method for ind
as.data.frame(x, ..., stringsAsFactors = FALSE)
                            
as_index(x, ...)

# S3 method for default
as_index(x, ...)

# S3 method for matrix
as_index(x, chainable = TRUE, ...)

# S3 method for data.frame
as_index(x, cols = 1:3, chainable = TRUE, ...)

is_index(x)

is_aggregate_index(x)</code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>rel</dt>
<dd><p>Period-over-period or fixed-base price relatives. Currently there is only a method for numeric vectors; these can be made with <code><a href="price-relative.html">price_relative()</a></code>.</p></dd>


<dt>period</dt>
<dd><p>A factor, or something that can be coerced into one, giving the time period associated with each price relative in <code>rel</code>. The ordering of time periods follows of the levels of <code>period</code>, to agree with <code><a href="https://rdrr.io/r/base/cut.POSIXt.html" class="external-link">cut()</a></code>. The default assumes that all price relatives belong to one time period.</p></dd>


<dt>ea</dt>
<dd><p>A factor, or something that can be coerced into one, giving the elemental aggregate associated with each price relative in <code>rel</code>. The default assumes that all price relatives belong to one elemental aggregate.</p></dd>


<dt>w</dt>
<dd><p>A numeric vector of weights for the price relatives in <code>rel</code>/index values in <code>x</code>. The default is equal weights.</p></dd>


<dt>contrib</dt>
<dd><p>Should quote contributions be calculated? The default does not calculate contributions.</p></dd>


<dt>chainable</dt>
<dd><p>Are the price relatives in <code>rel</code> period-over-period relatives for a chained calculation (the default)? This should be <code>FALSE</code> when <code>rel</code> are fixed-base relatives.</p></dd>


<dt>na.rm</dt>
<dd><p>Should missing values be removed? By default, missing values are not removed. Setting <code>na.rm = TRUE</code> is equivalent to overall mean imputation.</p></dd>


<dt>r</dt>
<dd><p>Order of the generalized mean to aggregate price relatives/index values. 0 for a geometric index (the default for making elemental indexes), 1 for an arithmetic index (the default for aggregating elemental indexes and averaging indexes over subperiods), or -1 for a harmonic index (usually for a Paasche index). Other values are possible; see <code><a href="https://rdrr.io/pkg/gpindex/man/generalized-mean.html" class="external-link">generalized_mean()</a></code> for details.</p></dd>


<dt>x, y</dt>
<dd><p>A price index, usually made by <code>elemental_index()</code> or <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code>.</p></dd>


<dt>pias</dt>
<dd><p>A price index aggregation structure. This can be made with <code><a href="aggregation-structure.html">aggregation_structure()</a></code>.</p></dd>


<dt>object</dt>
<dd><p>An aggregate price index, as made by <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code>.</p></dd>


<dt>repweights</dt>
<dd><p>A matrix, or something that can be coerced into one, of bootstrap replicate weights with a row for each elemental aggregate and a column for each replicate.</p></dd>


<dt>mse</dt>
<dd><p>Should covariances be centered off the value of the index in <code>object</code> (the default), or the mean of the replicates?</p></dd>


<dt>window</dt>
<dd><p>The size of the window used to average index values across subperiods. The default (3) turns a monthly index into into a quarterly one.</p></dd>


<dt>i, j, value</dt>
<dd><p>See <a href="https://rdrr.io/r/base/Extract.html" class="external-link">Extract</a>, with <code>value</code> being a numeric vector (or something that can coerced into one.)</p></dd>


<dt>n</dt>
<dd><p>See <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></code>.</p></dd>


<dt>stringsAsFactors</dt>
<dd><p>See <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></code>.</p></dd>


<dt>cols</dt>
<dd><p>A vector giving the positions/names of the period, level, and value columns in <code>x</code>. The default assumes that the first column contains time periods, the second contains levels, and the third contains index values.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to or used by methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
<div class="section">
<h3 id="elemental-indexes">Elemental indexes<a class="anchor" aria-label="anchor" href="#elemental-indexes"></a></h3>
<p>When supplied with a numeric vector, <code>elemental_index()</code> is a simple wrapper that applies <code><a href="https://rdrr.io/pkg/gpindex/man/generalized-mean.html" class="external-link">generalized_mean(r)</a></code> and <code><a href="https://rdrr.io/pkg/gpindex/man/contributions.html" class="external-link">contributions(r)</a></code> (if <code>contrib = TRUE</code>) to <code>rel</code> and <code>w</code> grouped by <code>ea</code> and <code>period</code>. That is, for every combination of elemental aggregate and time period, <code>elemental_index()</code> calculates an index based on a generalized mean of order <code>r</code> and, optionally, quote contributions (using names for <code>rel</code> as product names). The default (<code>r = 0</code> and no weights) makes Jevons elemental indexes. See chapter 8 (pp. 175--190) of the CPI manual (2020) for more detail about making elemental indexes, and chapter 5 of Balk (2008).</p>
<p>The default method simply coerces <code>rel</code> to a numeric prior to calling the method above.</p>
<p>The interpretation of the index depends on how the price relatives in <code>rel</code> are made. If these are period-over-period relatives, then the result is a collection of period-over-period elemental indexes; if these are fixed-base relatives, then the result is a collection of fixed-base (direct) elemental indexes. For the latter, <code>chainable</code> should be set to <code>FALSE</code> so that no subsequent methods assume that a chained calculation should be used.</p>
<p>By default, missing price relatives in <code>rel</code> will propagate throughout the index calculation. Ignoring missing values with <code>na.rm = TRUE</code> is the same as parental (or overall mean) imputation, and needs to be explicitly set in the call to <code>elemental_index()</code>. Explicit imputation of missing relatives, and especially imputation of missing prices, should be done prior to calling <code>elemental_index()</code>.</p>
<p>Indexes based on nested generalized means, like the Fisher index (and superlative quadratic mean indexes more generally), can be calculated by supplying the appropriate weights with <code><a href="https://rdrr.io/pkg/gpindex/man/transform-weights.html" class="external-link">nested_transmute()</a></code>; see the example below. It is important to note that there are several ways to make these weights, and this affects how quote contributions are calculated.</p>
</div>

<div class="section">
<h3 id="aggregate">Aggregate<a class="anchor" aria-label="anchor" href="#aggregate"></a></h3>
<p>The <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> method aggregates elemental indexes by looping over each time period in <code>x</code> and</p><ol><li><p>aggregates the elemental indexes with <code><a href="https://rdrr.io/pkg/gpindex/man/generalized-mean.html" class="external-link">generalized_mean(r)</a></code> for each level of <code>pias</code>;</p></li>
<li><p>aggregates quote contributions for each level of <code>pias</code> (if there are any);</p></li>
<li><p>price updates the weights in <code>pias</code> with <code><a href="https://rdrr.io/pkg/gpindex/man/transform-weights.html" class="external-link">factor_weights(r)</a></code> (only for period-over-period elemental indexes, i.e., <code>is_chainable_index(x) == TRUE</code>).</p></li>
</ol><p>The result is a collection of aggregated period-over-period indexes that can be chained together to get a fixed-base index when <code>x</code> are period-over-period elemental indexes. Otherwise, when <code>x</code> are fixed-base elemental indexes, the result is a collection of aggregated fixed-base (direct) indexes.</p>
<p>By default, missing elemental indexes will propagate when aggregating the index. Missing elemental indexes can be due to both missingness of these values in <code>x</code>, and the presence of elemental aggregates in <code>pias</code> that are not part of <code>x</code>. Setting <code>na.rm = TRUE</code> ignores missing values, and is equivalent to parental (or overall mean) imputation. As an aggregated price index generally cannot have missing values (for otherwise it can't be chained over time), any missing values for a level of <code>pias</code> are removed and recursively replaced by the value of its immediate parent.</p>
<p>In most cases aggregation is done with an arithmetic mean (the default), and this is detailed in chapter 8 (pp. 190--198) of the CPI manual (2020). Aggregating with a non-arithmetic mean follows the same steps, except that the elemental indexes are aggregated with a mean of a different order (e.g., harmonic for a Paasche index), and the method for price updating the weights is slightly different.</p>
<p>Aggregating quote contributions uses the method in chapter 9 of the CPI manual (equations 9.26 and 9.28) when aggregating with an arithmetic mean. With a non-arithmetic mean, arithmetic weights are constructed using <code><a href="https://rdrr.io/pkg/gpindex/man/transform-weights.html" class="external-link">transmute_weights(r, 1)</a></code> in order to apply this method.</p>
<p>There may not be contributions for all prices relatives in an elemental aggregate if the elemental indexes are built from several sources (as with <code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code>). In this case the contribution for a price relative in the aggregated index will be correct, but the sum of all contributions will not equal the change in the value of the index. This can also happen when aggregating an already aggregated index in which missing index values have been imputed (i.e., when <code>na.rm = TRUE</code>).</p>
<p>The <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code> method is a simple wrapper to calculate the variance matrix for an aggregated index when bootstrap replicate weights are available for the elemental aggregates. This approach is usually applicable when elemental aggregates are sampled, and provides an estimator of the sampling variance of the price index. It ignores any sampling variance from the elemental indexes (which often use judgmental sampling), and ultimately depends on the method of generating replicate weights. It returns a matrix of variances with a row for each upper-level index and a column for each time period. (Chapters 3 and 4 of Selvanathan and Rao (1994), especially section 4.7, provide analytic variance estimators for some common price indexes that are applicable with simple random sampling.) Note that any missing elemental indexes need to be explicitly imputed prior to using this method, otherwise they will propagate throughout the variance calculation.</p>
<p>Indexes can be aggregated over subperiods by taking the (usually arithmetic) mean of index values for each level over consecutive windows of subperiods. The <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> method constructs a set of windows of length <code>window</code>, starting in the first period of the index, and takes the unweighted mean of each index value in these windows for each level of the index. The last window is discarded if it is incomplete, so that index values are always averaged over <code>window</code> periods. The names for the first time period in each window form the new names for the aggregated time periods. Note that quote contributions are discarded when aggregating over subperiods.</p>
<p>An optional vector of weights can be specified when aggregating index values over subperiods, which is often useful when aggregating a Paasche index; see section 4.3 of Balk (2008) for details. It is usually easiest to specify these weights as a matrix with a row for each index value in <code>x</code> and a column for each time period.</p>
</div>

<div class="section">
<h3 id="combine">Combine<a class="anchor" aria-label="anchor" href="#combine"></a></h3>
<p>The <code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code> method combines two index objects with common time periods, merging together the index values and quote contributions for each time period in <code>x</code> and <code>y</code>. This is useful for building up an index when different elemental aggregates come from different sources of data, or use different index-number formulas.</p>
<p>The <code><a href="https://rdrr.io/r/utils/stack.html" class="external-link">stack()</a></code> method combines two index objects with common levels, stacking index values and quote contributions for each level in <code>y</code> after those in <code>x</code>. The <code><a href="https://rdrr.io/r/utils/stack.html" class="external-link">unstack()</a></code> method breaks up <code>x</code> into a list of indexes, one for each period in <code>x</code>. These methods can be used in a map-reduce to make an index with multiple aggregation structures (like a Paasche index).</p>
<p>It is not generally possible to merge aggregated indexes, as this would change the aggregation structure, so merging always returns an index of class <code>ind</code>. If at least one of <code>x</code> or <code>y</code> is an aggregate index then the result of stacking these indexes is also an aggregate index; otherwise, it is the same class as <code>x</code>.</p>
</div>

<div class="section">
<h3 id="extract">Extract<a class="anchor" aria-label="anchor" href="#extract"></a></h3>
<p>The extraction method treats <code>x</code> as a matrix of index values with (named) rows for each <code>level</code> and columns for each <code>period</code> in <code>x</code>. Unlike a matrix, dimensions are never dropped as indexing <code>x</code> always returns an index object. This means that indexing with a matrix is not possible, and only a submatrix can be extracted. As <code>x</code> is not an atomic vector, indexing with a single index like <code>x[1]</code> is taken to be the same as <code>x[1, ]</code>. Note that indexing an aggregated index cannot generally preserve the aggregation structure if any levels are removed, and in this case the resulting index is <em>not</em> an aggregated index.</p>
<p>The replacement method similarly treats <code>x</code> as a matrix, and behaves the same as replacing values in a matrix (except that <code>value</code> is coerced to numeric). Note that replacing the values of an index will remove the corresponding quote contributions (if any).</p>
<p>The <code><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels()</a></code> method extracts the levels of an index, and the <code><a href="https://rdrr.io/r/stats/time.html" class="external-link">time()</a></code> method extracts the time periods of the index. The <code><a href="https://rdrr.io/r/stats/start.html" class="external-link">start()</a></code> and <code><a href="https://rdrr.io/r/stats/start.html" class="external-link">end()</a></code> methods extract the first and last time period.</p>
<p>The <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> and <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail()</a></code> methods act as if <code>x</code> is a matrix of index values, and by default extract the time series for the first/last six levels of <code>x</code>.</p>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method summarizes <code>x</code> as a matrix of index values (i.e., the five-number summary for each period). If there are quote contributions, then these are also summarized as a matrix.</p>
</div>

<div class="section">
<h3 id="coerce">Coerce<a class="anchor" aria-label="anchor" href="#coerce"></a></h3>
<p>The <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix()</a></code> method turns an index into a matrix with a row for each level and a column for each period. The <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method turns an index into a data frame with three columns: period, level, and value.</p>
<p><code>as_index()</code> is useful to form an elemental index from pre-computed values. Numeric matrices are coerced into an elemental index object by treating each column as a separate time period, and each row as an elemental aggregate. Column names are used to denote time periods, and row names are used to denote elemental aggregates (so they must be unique). This essentially reverses calling <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix()</a></code> on an index object. If a dimension is unnamed, then it is given a sequential label from 1 to the size of that dimension. The default method coerces <code>x</code> to a matrix prior to using the matrix method.</p>
<p>The data frame method for <code>as_index()</code> is best understood as reversing the effect of <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> on an index object. It constructs a matrix by taking the unique values of <code>x[[cols[1]]]</code> as columns and the unique values of <code>x[[cols[2]]]</code> as rows (in the order they appear). It then populates this matrix with the corresponding values in <code>x[[cols[3]]]</code>, and uses the matrix method for <code>as_index()</code>. Note that the resulting index is therefore sensitive to the ordering of <code>x</code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Most of these functions return index objects of class <code>ind</code>. These often behaves like a matrix with a row for each level of the index and a column for each time period, and have the following components.</p>
<dl><dt>index</dt>
<dd><p>A named list with an entry for each <code>period</code> that gives a named vector of index values for each level in <code>ea</code>.</p></dd>

<dt>contrib</dt>
<dd><p>A named list with an entry for each <code>period</code>, which itself contains a named list with an entry for each level in <code>ea</code> with a named vector that gives the additive contribution for each price relative. If <code>contrib = FALSE</code>, then each of these vectors is of length 0.</p></dd>

<dt>levels</dt>
<dd><p>The levels for <code>ea</code>.</p></dd>

<dt>time</dt>
<dd><p>The levels for <code>period</code>.</p></dd>

<dt>has_contrib</dt>
<dd><p>The value of <code>contrib</code>.</p></dd>

<dt>chainable</dt>
<dd><p>The value of <code>chainable</code>, usually <code>TRUE</code>.</p></dd>


</dl><p><code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> returns an aggregate index. This is an object of class <code>agg_ind</code>, inheriting from class <code>ind</code>, which has the following components.</p>
<dl><dt>index</dt>
<dd><p>A named list with an entry for each <code>period</code> in <code>x</code> that gives a named vector of index values for each level in <code>pias</code>.</p></dd>

<dt>contrib</dt>
<dd><p>A named list with an entry for each <code>period</code>, which itself contains a list with an entry for each level in <code>pias</code> with a named vector that gives the additive contribution for each price relative.</p></dd>

<dt>levels</dt>
<dd><p>The levels for <code>pias</code>.</p></dd>

<dt>time</dt>
<dd><p>The levels for <code>period</code> from <code>x</code>.</p></dd>

<dt>has_contrib</dt>
<dd><p>The value of <code>has_contrib</code> from <code>x</code>.</p></dd>

<dt>chainable</dt>
<dd><p>The value for <code>chainable</code> from <code>x</code>, usually <code>TRUE.</code></p></dd>

<dt>r</dt>
<dd><p>The value for <code>r</code>, usually <code>1</code>.</p></dd>

<dt>pias</dt>
<dd><p>A list containing the <code>child</code>, <code>parent</code>, <code>eas</code>, and <code>height</code> components of <code>pias</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Balk, B. M. (2008). <em>Price and Quantity Index Numbers</em>. Cambridge University Press.</p>
<p>ILO, IMF, OECD, Eurostat, UN, and World Bank. (2020). <em>Consumer Price Index Manual: Theory and Practice</em>. International Monetary Fund.</p>
<p>Selvanathan, E. A., and Rao, D. S. P. (1994). <em>Index Numbers: A Stochastic Approach</em>. MacMillan.</p>
    </div>
    <div class="section level2">
    <h2 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h2>
    <p>The <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code> method was influenced by a SAS routine by Justin Francis that was first ported to R by Ambuj Dewan, and subsequently rewritten by Steve Martin.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="price-relative.html">price_relative</a></code> for making price relatives for the same products over time, and <code><a href="impute-prices.html">carry_forward</a></code> and <code><a href="impute-prices.html">shadow_price</a></code> for imputations for missing prices.</p>
<p><code><a href="aggregation-structure.html">aggregation_structure</a></code> for making a price index aggregation structure.</p>
<p><code><a href="chain.html">chain</a></code> for chaining period-over-period indexes, and <code><a href="chain.html">rebase</a></code> for rebasing an index.</p>
<p><code><a href="contrib.html">contrib</a></code> for extracting quote contributions.</p>
<p>The <code>sps_repweights()</code> function in the <span class="pkg">sps</span> package to generate replicates weights when elemental aggregates are sampled using sequential Poisson sampling.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rel <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, ea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A two-level aggregation structure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pias</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregation-structure.html">aggregation_structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"top"</span>, <span class="st">"top"</span>, <span class="st">"top"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate Jevons elemental indexes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">epr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu">elemental_index</span><span class="op">(</span><span class="va">rel</span>, <span class="va">period</span>, <span class="va">ea</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 2.828427 6.928203</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same as using lm() or tapply()</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span> <span class="op">~</span> <span class="va">ea</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">prices</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eaa:factor(period)1 eab:factor(period)1 eaa:factor(period)2 eab:factor(period)2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1.732051            2.828427            5.916080            6.928203 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">rel</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">ea</span><span class="op">)</span>, <span class="fu">gpindex</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gpindex/man/generalized-mean.html" class="external-link">geometric_mean</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 2.828427 6.928203</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract the indexes like a matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">epr</span><span class="op">[</span><span class="st">"a"</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.732051 5.91608</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">epr</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 6.928203</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">epr</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># can be useful for doing specific imputations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate (note the imputation for elemental index 'c')</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">epr</span>, <span class="va">pias</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.218951 6.037662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a   1.000000 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   2.218951 6.037662</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregation can equivalently be done as matrix multiplication</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pias</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="chain.html">chain</a></span><span class="op">(</span><span class="va">index</span><span class="op">[</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.218951 13.39728</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Merge two indexes prior to aggregation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prices2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rel <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, ea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">epr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices2</span>, <span class="fu">elemental_index</span><span class="op">(</span><span class="va">rel</span>, <span class="va">period</span>, <span class="va">ea</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">epr</span>, <span class="va">epr2</span><span class="op">)</span>, <span class="va">pias</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 1.975501 5.984362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a   1.000000 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   1.732051 5.916080</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stack two indexes prior to aggregation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prices3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rel <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, ea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">epr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices3</span>, <span class="fu">elemental_index</span><span class="op">(</span><span class="va">rel</span>, <span class="va">period</span>, <span class="va">ea</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">epr</span>, <span class="va">epr3</span><span class="op">)</span>, <span class="va">pias</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2        3        4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top       NA       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a   1.000000 1.000000 1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   2.828427 6.928203 2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c         NA       NA       NA       NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Unstack does the reverse</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">unstack</a></span><span class="op">(</span><span class="va">epr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">unstack</a></span><span class="op">(</span><span class="va">epr3</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">unstack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">epr</span>, <span class="va">epr3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract useful features of the index</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">index</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.218951 6.037662</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">index</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.000000 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c 2.218951 6.037662</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "top" "a"   "b"   "c"  </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1" "2"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/start.html" class="external-link">start</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/start.html" class="external-link">end</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "2"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Indexes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1               2        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :1.000   Min.   :1.000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:1.914   1st Qu.:4.778  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :2.219   Median :6.038  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :2.067   Mean   :5.001  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:2.371   3rd Qu.:6.260  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :2.828   Max.   :6.928  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Turn the index into a data frame/matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   period level    value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1   top 2.218951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      1     a 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      1     b 2.828427</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      1     c 2.218951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      2   top 6.037662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      2     a 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      2     b 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      2     c 6.037662</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.218951 6.037662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a   1.000000 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   2.218951 6.037662</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu">as_index</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">epr</span><span class="op">)</span><span class="op">)</span>, <span class="va">epr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu">as_index</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">epr</span><span class="op">)</span><span class="op">)</span>, <span class="va">epr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate a CSWD index (same as the Jevons in this example) </span></span></span>
<span class="r-in"><span><span class="co"># as an arithmetic index by constructing appropriate weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/marberts/gpindex" class="external-link">gpindex</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A general function to calculate weights to turn the geometric</span></span></span>
<span class="r-in"><span><span class="co"># mean of the arithmetic and harmonic mean (i.e., Fisher mean)</span></span></span>
<span class="r-in"><span><span class="co"># into an arithmetic mean</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gpindex/man/operators.html" class="external-link">grouped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/gpindex/man/transform-weights.html" class="external-link">nested_transmute</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">prices</span>, </span></span>
<span class="r-in"><span>    <span class="fu">elemental_index</span><span class="op">(</span><span class="va">rel</span>, <span class="va">period</span>, <span class="va">ea</span>, <span class="fu">fw</span><span class="op">(</span><span class="va">rel</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">ea</span><span class="op">)</span><span class="op">)</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 2.828427 6.928203</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Steve Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

