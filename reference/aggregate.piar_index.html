<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Aggregate elemental price indexes — aggregate.piar_index • piar</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate elemental price indexes — aggregate.piar_index"><meta name="description" content="Aggregate elemental price indexes with a price index aggregation structure."><meta property="og:description" content="Aggregate elemental price indexes with a price index aggregation structure."><meta property="og:image" content="https://marberts.github.io/piar/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">piar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/piar.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marberts/piar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Aggregate elemental price indexes</h1>
      <small class="dont-index">Source: <a href="https://github.com/marberts/piar/blob/main/R/aggregate.piar_index.R" class="external-link"><code>R/aggregate.piar_index.R</code></a></small>
      <div class="d-none name"><code>aggregate.piar_index.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Aggregate elemental price indexes with a price index aggregation structure.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'chainable_piar_index'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">pias</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  contrib <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  r <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  include_ea <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'direct_piar_index'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">pias</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  contrib <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  r <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  include_ea <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A price index, usually made by <code><a href="elemental_index.html">elemental_index()</a></code>.</p></dd>


<dt id="arg-pias">pias<a class="anchor" aria-label="anchor" href="#arg-pias"></a></dt>
<dd><p>A price index aggregation structure or something that can be
coerced into one. This can be made with <code><a href="aggregation_structure.html">aggregation_structure()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Should missing values be removed? By default, missing values
are not removed. Setting <code>na.rm = TRUE</code> is equivalent to overall mean
imputation.</p></dd>


<dt id="arg-contrib">contrib<a class="anchor" aria-label="anchor" href="#arg-contrib"></a></dt>
<dd><p>Aggregate percent-change contributions in <code>x</code> (if any)?</p></dd>


<dt id="arg-r">r<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>Order of the generalized mean to aggregate index values. 0 for a
geometric index (the default for making elemental indexes), 1 for an
arithmetic index (the default for aggregating elemental indexes and
averaging indexes over subperiods), or -1 for a harmonic index (usually for
a Paasche index). Other values are possible; see
<code><a href="https://marberts.github.io/gpindex/reference/generalized_mean.html" class="external-link">gpindex::generalized_mean()</a></code> for details.</p></dd>


<dt id="arg-include-ea">include_ea<a class="anchor" aria-label="anchor" href="#arg-include-ea"></a></dt>
<dd><p>Should indexes for the elemental aggregates be included
along with the aggregated indexes? By default, all index values are returned.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An aggregate price index that inherits from the class of <code>x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> method loops over each time period in <code>x</code> and</p><ol><li><p>aggregates the elemental indexes with
<code><a href="https://marberts.github.io/gpindex/reference/generalized_mean.html" class="external-link">gpindex::generalized_mean(r)()</a></code> for each level
of <code>pias</code>;</p></li>
<li><p>aggregates percent-change contributions for each level of
<code>pias</code> (if there are any and <code>contrib = TRUE</code>);</p></li>
<li><p>price updates the weights in <code>pias</code> with
<code><a href="https://marberts.github.io/gpindex/reference/factor_weights.html" class="external-link">gpindex::factor_weights(r)()</a></code> (only for
period-over-period elemental indexes).</p></li>
</ol><p>The result is a collection of aggregated period-over-period indexes that
can be chained together to get a fixed-base index when <code>x</code> are
period-over-period elemental indexes. Otherwise, when <code>x</code> are fixed-base
elemental indexes, the result is a collection of aggregated fixed-base
(direct) indexes.</p>
<p>By default, missing elemental indexes will propagate when aggregating the
index. Missing elemental indexes can be due to both missingness of these
values in <code>x</code>, and the presence of elemental aggregates in <code>pias</code>
that are not part of <code>x</code>. Setting <code>na.rm = TRUE</code> ignores missing
values, and is equivalent to parental (or overall mean) imputation. As an
aggregated price index generally cannot have missing values (for otherwise
it can't be chained over time and weights can't be price updated), any
missing values for a level of <code>pias</code> are removed and recursively replaced
by the value of its immediate parent.</p>
<p>In most cases aggregation is done with an arithmetic mean (the default), and
this is detailed in chapter 8 (pp. 190–198) of the CPI manual (2020).
Aggregating with a non-arithmetic mean follows the same steps, except that
the elemental indexes are aggregated with a mean of a different order (e.g.,
harmonic for a Paasche index), and the method for price updating the weights
is slightly different. Note that, because aggregation is done with a
generalized mean, the resulting index is consistent-in-aggregation at each
point in time.</p>
<p>Aggregating percent-change contributions uses the method in chapter 9 of the
CPI manual (equations 9.26 and 9.28) when aggregating with an arithmetic
mean. With a non-arithmetic mean, arithmetic weights are constructed using
<code><a href="https://marberts.github.io/gpindex/reference/transmute_weights.html" class="external-link">gpindex::transmute_weights(r, 1)()</a></code> in order
to apply this method.</p>
<p>There may not be contributions for all prices relatives in an elemental
aggregate if the elemental indexes are built from several sources (as with
<code><a href="merge.piar_index.html">merge()</a></code>). In this case the contribution for
a price relative in the aggregated index will be correct, but the sum of all
contributions will not equal the change in the value of the index. This can
also happen when aggregating an already aggregated index in which missing
index values have been imputed (i.e., when <code>na.rm = TRUE</code> and
<code>contrib = FALSE</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>For large indexes it can be much faster to turn the aggregation structure
into an aggregation matrix with
<code><a href="as.matrix.piar_aggregation_structure.html">as.matrix()</a></code>, then aggregate
elemental indexes as a matrix operation when there are no missing
values. See the examples for details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Balk, B. M. (2008). <em>Price and Quantity Index Numbers</em>.
Cambridge University Press.</p>
<p>IMF, ILO, OECD, Eurostat, UNECE, and World Bank. (2020).
<em>Consumer Price Index Manual: Concepts and Methods</em>.
International Monetary Fund.</p>
<p>von der Lippe, P. (2007). <em>Index Theory and Price Statistics</em>. Peter Lang.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other index methods:
<code><a href="sub-.piar_index.html">[.piar_index</a>()</code>,
<code><a href="as.data.frame.piar_index.html">as.data.frame.piar_index</a>()</code>,
<code><a href="chain.html">chain</a>()</code>,
<code><a href="contrib.html">contrib</a>()</code>,
<code><a href="head.piar_index.html">head.piar_index</a>()</code>,
<code><a href="is.na.piar_index.html">is.na.piar_index</a>()</code>,
<code><a href="levels.piar_index.html">levels.piar_index</a>()</code>,
<code><a href="mean.piar_index.html">mean.piar_index</a></code>,
<code><a href="merge.piar_index.html">merge.piar_index</a>()</code>,
<code><a href="split.piar_index.html">split.piar_index</a>()</code>,
<code><a href="stack.piar_index.html">stack.piar_index</a>()</code>,
<code><a href="time.piar_index.html">time.piar_index</a>()</code>,
<code><a href="window.piar_index.html">window.piar_index</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  rel <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A two-level aggregation structure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pias</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregation_structure.html">aggregation_structure</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"top"</span>, <span class="st">"top"</span>, <span class="st">"top"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">)</span>, weights <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate Jevons elemental indexes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">elemental</span> <span class="op">&lt;-</span> <span class="fu"><a href="elemental_index.html">elemental_index</a></span><span class="op">(</span><span class="va">prices</span>, <span class="va">rel</span> <span class="op">~</span> <span class="va">period</span> <span class="op">+</span> <span class="va">ea</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period-over-period price index for 2 levels over 2 time periods </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b 2.828427 6.928203</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate (note the imputation for elemental index 'c')</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">elemental</span>, <span class="va">pias</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period-over-period price index for 4 levels over 2 time periods </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.462968 6.690949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a   1.732051 5.916080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   2.828427 6.928203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   2.462968 6.690949</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregation can equivalently be done as matrix multiplication</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pias</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="chain.html">chain</a></span><span class="op">(</span><span class="va">index</span><span class="op">[</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> top 2.462968 16.4796</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

